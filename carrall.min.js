/*! carrall 09-03-2017 */
var module;module||(module={}),module.exports=window.carrall={fsTries:0,setup:function(a){var b,c;return c=function(b){return b.isDirectory?(carrall._fsroot=b,a()):carrall.fsTries<5?(console.log("Didn't get fs object, trying again"),carrall.fsTries++,window.setTimeout(function(){return carrall.setup(a)},500)):alert("Failed to get file system object")},$("label").each(function(a,b){return $(b).html(carrall.localize(b.id.replace(/Label$/,"")))}),window.cordova?(b=carrall.isIOS()?cordova.file.dataDirectory:cordova.file.externalApplicationStorageDirectory,window.resolveLocalFileSystemURL(b,c,c)):a()},isIOS:function(){return window.device&&window.device.platform?"iOS"===device.platform:/iphone|ipad|ipod/i.test(navigator.userAgent)},isAndroid:function(){return window.device&&window.device.platform?"Android"===device.platform||"amazon-fireos"===device.platform:/android/i.test(navigator.userAgent)},hasInternetConnection:function(){return carrall.isAndroid()&&window.cordova&&!navigator.connection&&alert("You need to install the org.apache.cordova.network-information plugin"),navigator.connection?navigator.connection.type!==Connection.NONE:navigator.onLine},hasDecentInternetConnection:function(){return navigator.connection?navigator.connection.type===Connection.CELL_3G||navigator.connection.type===Connection.CELL_4G||navigator.connection.type===Connection.WIFI||navigator.connection.type===Connection.ETHERNET:navigator.onLine},getSystemLanguage:function(){var a;return navigator&&navigator.userAgent&&(a=navigator.userAgent.match(/android.*\W(\w\w)-(\w\w)\W/i))&&(a=a[1]),!a&&navigator&&(navigator.language?a=navigator.language:navigator.browserLanguage?a=navigator.browserLanguage:navigator.systemLanguage?a=navigator.systemLanguage:navigator.userLanguage&&(a=navigator.userLanguage),a=a.substr(0,2)),a?a:"en"},localize:function(a){return Localisation.Strings[carrall.getSystemLanguage()][a]||Localisation.Strings.en[a]},orientation:function(){return window.innerWidth>window.innerHeight?"landscape":"portrait"},getPhonegapPath:function(){var a,b;return a=window.location.pathname,b=a.substring(0,a.lastIndexOf("/")+1)},rerootPathUnderApp:function(a){var b,c;return window.cordova&&carrall.isIOS()?(c=cordova.file.applicationStorageDirectory.match(/.*\/([0-9A-F-]{8,})/),c?(b=c[1],a.replace(/(.*\/)[0-9A-F-]{8,}\//,"$1"+b+"/")):a):a},ensureFreeSpace:function(a,b){return window.requestFileSystem(LocalFileSystem.PERSISTENT,a,b,function(){return navigator.notification.alert(carrall.localize("noFreeSpace"),b,carrall.localize("noFreeSpaceTitle"),carrall.localize("buttonOK"))})},disableDoubleTap:function(a){var b;return $(a).bind("touchstart",b=function(a){var b,c,d,e;return e=a.timeStamp,d=$(this).data("lastTouch")||e,b=e-d,c=a.originalEvent.touches.length,$(this).data("lastTouch",e),!b||b>500||c>1?void 0:(a.preventDefault(),$(this).trigger("click").trigger("click"))})},stopVScroll:function(a,b,c){var d;if(window.cordova)return document.addEventListener("touchmove",function(a){var b;return b=$(a.target),b.hasClass("scrollable")||1===b.parents(".scrollable-container").length?void 0:a.preventDefault()},!1),d=void 0,$(a).bind("touchstart",function(a){return d=a}),$(a).bind("touchmove",function(a){var e;return e=parseInt(a.originalEvent.pageY-d.originalEvent.pageY),e>b||c&&Math.abs(e)>5?(a.preventDefault(),!1):void 0})},saveJSONFile:function(a,b,c){var d,e,f;return window.cordova?(d=function(a){return console.log(a)},f=function(a){return a.write(JSON.stringify(b,c))},e=function(a){return a.createWriter(f,d)},carrall._fsroot.getFile(a,{create:!0,exclusive:!1},e,d)):void window.localStorage.setItem(a,JSON.stringify(b,c))},loadJSONFile:function(a,b,c,d){var e,f,g,h;return f=d,window.cordova?(g=function(a){var e;return e=new FileReader,e.onloadend=function(a){var e;try{e=JSON.parse(a.target.result)}catch(f){}return e&&(b[c]=e),d()},e.onerror=function(a){return console.log(a)},e.readAsText(a)},h=function(a){return a.file(g,f)},carrall._fsroot.getFile(a,{create:!0,exclusive:!1},h,f)):(e=window.localStorage.getItem(a),e&&(b[c]=JSON.parse(e)),d())},saveXML:function(a,b,c){var d,e,f,g;return e=(new XMLSerializer).serializeToString(b[0]),window.cordova?(d=function(a){return console.log(a)},g=function(a){return a.onwriteend=c,a.write(e)},f=function(a){return a.createWriter(g,d)},a=a.replace(carrall._fsroot.fullPath+"/",""),console.log("Trying to save "+a),carrall._fsroot.getFile(a,{create:!0,exclusive:!1},f,d)):(window.localStorage.setItem(a,e),c())},loadXML:function(a,b,c){var d,e;return window.cordova?(a.match(/^file:\//)||(a="file://"+a),c||(c=function(a){return console.log(a)}),e=a+"?"+(new Date).getTime(),$.ajax({url:e,method:"GET",dataType:"xml",error:c}).done(function(a){return b($(a))})):(d=window.localStorage.getItem(a),d?b($data):c())}};